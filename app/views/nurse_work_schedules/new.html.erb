<div class="nurse-work-schedule-wrapper">
    <h1 class="text-center text-white"><%= Date.current.next_month.month %> 月勤務表</h1>
    <table>
      <tr>
        <th class="fixed01"> </th>
        <th class="fixed02"> </th>
        <% (1..@day).each do |day| %>
            <% if display_of_day_of_the_week_new_view(day) == "日" %>
              <th class="red-color-of-display"><%= display_of_day_of_the_week_new_view(day)%></th>
            <% elsif display_of_day_of_the_week_new_view(day) == "土" %>
              <th class="blue-color-of-display"><%= display_of_day_of_the_week_new_view(day) %></th>
            <% else %>
              <th><%= display_of_day_of_the_week_new_view(day) %></th>
            <% end %>
        <% end %>
      </tr>
      <tr>
        <th class="fixed01"> </th>
        <th class="fixed02"> </th>
        <% (1..@day).each do |day| %>
          <th><%= day %></th>
        <% end %>
      </tr>
      <%= form_tag(nurse_work_schedules_path, method: :post) do |w| %>
        <% @nurses.each do |nurse| %>
          <tr>
            <td class="fixed01">
              <%= nurse_select(nurse).employment_i18n %> 
              <%# gemにenum_helpをインストールしてconfig/application.rbにconfig.paths.add 'lib', eager_load: trueをいれ、term.employmentのカラム名の後に_i18nを入れる%>
            </td>
            <td class="fixed02">
              <%= link_to nurse_path(nurse.id) do %>
                <%= nurse.name %>
              <% end %>
            </td>
              <% @day.times do |t| %>
                
                <td>
                  <% if @hope_holidays.find_by(nurse_id: nurse.id, hope_holiday:Time.zone.parse("#{Date.current.next_month.year}-#{Date.current.next_month.month}-#{t+1}")) %>
                    <% if @hope_holidays.find_by(nurse_id: nurse.id, hope_holiday:Time.zone.parse("#{Date.current.next_month.year}-#{Date.current.next_month.month}-#{t+1}")).holiday_type == "public_holiday" %>
                      <%= select_tag "nurse_#{nurse.id}[work_type_#{t+1}][work_type]", options_for_select(select_condition(nurse), disabled:[0,1,2,4,5]), class: 'form-control-holiday-type'%>
                    <% elsif @hope_holidays.find_by(nurse_id: nurse.id, hope_holiday:Time.zone.parse("#{Date.current.next_month.year}-#{Date.current.next_month.month}-#{t+1}")).holiday_type == "paid_holiday"%>
                      <%= select_tag "nurse_#{nurse.id}[work_type_#{t+1}][work_type]", options_for_select(select_condition(nurse), disabled:[0,1,2,3,5]), class: 'form-control-holiday-type'%>
                    <% elsif @hope_holidays.find_by(nurse_id: nurse.id, hope_holiday:Time.zone.parse("#{Date.current.next_month.year}-#{Date.current.next_month.month}-#{t+1}")).holiday_type == "refresh_vacation"%>
                      <%= select_tag "nurse_#{nurse.id}[work_type_#{t+1}][work_type]", options_for_select(select_condition(nurse), disabled:[0,1,2,3,4]), class: 'form-control-holiday-type'%>
                    <% end %>
                  <% else %>
                    <%= select_tag "nurse_#{nurse.id}[work_type_#{t+1}][work_type]", options_for_select(select_condition(nurse), 0), class: 'form-control-work-type' %>
                  <% end %>
                  <%= hidden_field_tag "nurse_#{nurse.id}[work_type_#{t+1}][work_day]", "#{Date.current.next_month.year}-#{Date.current.next_month.month}-#{t+1}" %>
                  <%= hidden_field_tag "nurse_#{nurse.id}[work_type_#{t+1}][nurse_id]", nurse.id%>
                </td>
              <% end %>
          </tr>
        <% end %>
        <%= submit_tag( "登録", class: 'btn-block btn-white' )%>
      <% end %>
    </table>
</div>